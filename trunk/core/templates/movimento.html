<?python
from promogest.ui.utils import leggiCliente
from promogest.ui.utils import leggiFornitore
from promogest.Environment import conf
?>
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:py="http://genshi.edgewall.org/"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        lang="en">
    <head>
        <title>Dettaglio movimento di magazzino</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <xi:include href="style.css"><xi:fallback/></xi:include>
    </head>
    <body>
        <table cellpadding="0" cellspacing="0" border="0">
            <tr>
		<td class= "report-header" colspan="2"><h3>Registro: <strong>${dao.registro_numerazione}</strong></h3></td>
                <td class="report-header" colspan="2"><h3>Numero: <strong>${dao.numero}</strong> / <strong py:content="dao.parte"></strong></h3></td>
            </tr>
	</table>

	<table cellpadding="0" cellspacing="0" border="0">
            <tr><td colspan="4" class="table-header">Dati movimento</td></tr>
            <tr>
                <td width="140px" class="odd-detail">Operazione</td>
                <td class="odd-detail"><strong>${dao.operazione}</strong></td>
            </tr>
	   <tr>
	        <td class="even-detail">Data movimento</td>
                <td class="even-detail">
                    <strong py:if="dao.data_movimento is not None">
                        <strong>${dao.data_movimento.strftime('%d/%m/%Y %H:%M')}</strong>
                    </strong>
                </td>
	</tr>

            <tr py:if="dao.id_cliente is not None">
                <td class="odd-detail">Cliente</td>
                <td class="odd-detail">
                    <strong py:if="dao.ragione_sociale_cliente is not None">
                        <strong>${dao.ragione_sociale_cliente}</strong>
                        <?python
                        cliente = leggiCliente(dao.id_cliente)
                        ?>
			<strong> (</strong>
                        <strong py:with="cliente = leggiCliente(dao.id_cliente)">${cliente['cognome'] + ' ' + cliente['nome']}</strong>
			<strong> )</strong>
                    </strong>
                </td>
            </tr>
            <tr py:if="dao.id_fornitore is not None">
                <td class="odd-detail">Fornitore</td>
                <td class="odd-detail">
                    <strong py:if="dao.ragione_sociale_fornitore is not None">
                        <strong>${dao.ragione_sociale_fornitore}</strong>
                        <?python
                        fornitore = leggiFornitore(dao.id_fornitore)
                        ?>
			<strong> (</strong>
                        <strong py:with="fornitore = leggiFornitore(dao.id_fornitore)">${fornitore['cognome'] + ' ' + fornitore['nome']}</strong>
			<strong> )</strong>
                    </strong>
                </td>
            </tr>
            <tr>
                <td class="even-detail">Note interne</td>
                <td class="even-detail"><strong>${dao.note_interne}</strong></td>
            </tr>
        </table>

        <table cellpadding="0" cellspacing="4" border="0">
        <tr><td colspan="9" class="table-header">Righe movimento</td></tr>
        <tr>
            <td class="even-detail">Magazzino</td>
            <td class="even-detail">Articolo</td>
            <td class="even-number">Iva (%)</td>
            <td class="even-number">Quantita'</td>
            <td class="even-number">Prezzo netto</td>
            <td class="even-number">Totale</td>
        </tr>
        <tr py:for="riga in dao.righe">
            <td width="16%" class="odd-detail" py:if="riga.id_magazzino is not None"><light>${riga.magazzino[:35]}</light></td>
            <td width="16%" class="odd-detail" py:if="riga.id_magazzino is None"><light></light></td>
            <td width="40%" class="odd-detail"><light>${riga.descrizione[:35]}</light></td>
            <td width="10%" class="odd-number"><light>${'%14.2f' % riga.percentuale_iva}</light></td>
            <td width="12%" class="odd-number"><light>${conf.number_format % ( riga.quantita * riga.moltiplicatore )}</light></td>
            <td width="12%" class="odd-number"><light>${conf.number_format % riga.valore_unitario_netto}</light></td>
            <td width="10%" class="odd-number"><strong>${conf.number_format % ( riga.quantita * riga.moltiplicatore * riga.valore_unitario_netto )}</strong></td>
        </tr>
        </table>
    </body>
</html>